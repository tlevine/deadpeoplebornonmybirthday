#!/bin/sh
# Avoid committing all of the data to the repository.

set -e

# Update
git pull

tmp=$(mktemp -d)
cp -R www $tmp

# Generate yaml templates

# Compile
(
  cd $tmp/www
  nanoc compile
)


# Mount S3
mkdir $tmp/s3
s3fs -o use-rrs=1 www.deadpeoplebornonmybirthday.com $tmp/s3

# Copy application stuff
cp -R $tmp/www/output/* $tmp/s3

# Copy data over
cp data/people/1800-*.json $tmp/s3/data/people

sudo umount $tmp/s3
